var J=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var s=(r,t,e)=>(J(r,t,"read from private field"),e?e.call(r):t.get(r)),o=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},l=(r,t,e,i)=>(J(r,t,"write to private field"),i?i.call(r,e):t.set(r,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const h of n)if(h.type==="childList")for(const u of h.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function e(n){const h={};return n.integrity&&(h.integrity=n.integrity),n.referrerPolicy&&(h.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?h.credentials="include":n.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(n){if(n.ep)return;n.ep=!0;const h=e(n);fetch(n.href,h)}})();class A{constructor(t){this.value=t}get ok(){return!0}get err(){return!1}expect(){return this.value}expectErr(t){throw new Error(t)}get unwrap(){return this.value}unwrapOr(){return this.value}andThen(t){return t(this.value)}orElse(){return this}map(t){return new A(t(this.value))}mapErr(){return this}get toOptional(){return new Y(this.value)}safeUnwrap(){return this.value}}var S;const G=class G{constructor(t){o(this,S,void 0);l(this,S,new Error().stack),this.error=t}get valid(){return!1}get ok(){return!1}get err(){return!0}expect(t){throw new Error(t+`
Original `+s(this,S)+`
Expect Error`)}expectErr(){return this.error}get unwrap(){throw new Error(`Tried to unwrap Error
Original `+s(this,S)+`
Unwrap Error`)}unwrapOr(t){return t}andThen(){return this}orElse(t){return t(this.error)}map(){return this}mapErr(t){return new G(t(this.error))}get toOptional(){return new ee}get stack(){return s(this,S)}};S=new WeakMap;let P=G,Y=class q{constructor(t){this.value=t}get valid(){return!0}get some(){return!0}get none(){return!1}expect(){return this.value}get unwrap(){return this.value}unwrapOr(){return this.value}andThen(t){return t(this.value)}orElse(){return this}map(t){return new q(t(this.value))}toResult(){return new A(this.value)}};class ee{get valid(){return!1}get some(){return!1}get none(){return!0}expect(t){throw new Error(t)}get unwrap(){throw new Error("Tried to unwrap None")}unwrapOr(t){return t}andThen(){return this}orElse(t){return t()}map(){return this}toResult(t){return new P(t)}}function C(r){return new A(r)}function ae(r){return new P(r)}function W(r){return new Y(r)}function U(){return new ee}class ce{constructor(){this.subscribers=[]}subscribe(t,e){return this.subscribers.includes(t)?(console.warn("Function already registered as subscriber"),t):(this.onSubscribe(this.subscribers.length==0),this.subscribers.push(t),e&&this.then(i=>{t(i)}),t)}unsubscribe(t){const e=this.subscribers.indexOf(t);return e!=-1?(this.onUnsubscribe(this.subscribers.length==1),this.subscribers.splice(e,1)):console.warn("Subscriber not found with state",this,t),t}related(){return U()}onSubscribe(t){}onUnsubscribe(t){}inUse(){return!!this.subscribers.length}hasSubscriber(t){return this.subscribers.includes(t)}updateSubscribers(t){for(let e=0,i=this.subscribers.length;e<i;e++)try{this.subscribers[e](t)}catch(n){console.warn("Failed while calling subscribers ",n,this,this.subscribers[e])}}}var b,D,f;class M extends ce{constructor(e,i,n){super();o(this,b,void 0);o(this,D,void 0);o(this,f,void 0);if(i&&l(this,D,i===!0?h=>{var u;return(u=s(this,f))!=null&&u.limit?s(this,f).limit(h).map(V=>C(V)):W(C(h))}:i),n&&l(this,f,n),typeof e=="function"){let h=new Promise(u=>{this.then=async V=>(l(this,b,e()),delete this.then,delete this.write,delete this.get,u(),V(s(this,b))),this.get=()=>(l(this,b,e()),delete this.then,delete this.write,delete this.get,u(),s(this,b))});this.write=u=>{h.then(()=>{delete this.write,this.write(u)})}}else l(this,b,e)}async then(e){return e(s(this,b))}get(){return s(this,b)}related(){var e;return(e=s(this,f))!=null&&e.related?s(this,f).related():U()}write(e){s(this,D)&&s(this,b).ok&&s(this,b).value!==e&&s(this,D).call(this,e).map(this.set.bind(this))}check(e){var i;return(i=s(this,f))!=null&&i.check?s(this,f).check(e):U()}limit(e){var i;return(i=s(this,f))!=null&&i.limit?s(this,f).limit(e):W(e)}set(e){l(this,b,e),this.updateSubscribers(e)}}b=new WeakMap,D=new WeakMap,f=new WeakMap;var g=(r=>(r.write="w",r.read="r",r.none="n",r))(g||{});class de{constructor(t,e,i){this.type=t,this.target=e,this.data=i}}class be{constructor(t){this.eventHandler_ListenerStorage={},this.target=t}on(t,e){let i=this.eventHandler_ListenerStorage[t];return i?i.indexOf(e)==-1?i.push(e):console.warn("Subscriber already in handler"):this.eventHandler_ListenerStorage[t]=[e],e}once(t,e){return this.on(t,function(i){return e(i),!0}),e}off(t,e){let i=this.eventHandler_ListenerStorage[t];if(i){let n=i.indexOf(e);n!=-1?i.splice(n,1):console.warn("Subscriber not in handler")}return e}emit(t,e){let i=this.eventHandler_ListenerStorage[t];if(i&&i.length>0){let n=Object.freeze(new de(t,this.target,e));i.length>1&&(i=[...i]);for(let h=0,u=i.length;h<u;h++)try{i[h](n)===!0&&(i.splice(h,1),u--,h--)}catch(V){console.warn("Failed while dispatching event",V)}}}clear(t){this.eventHandler_ListenerStorage[t]=[]}inUse(t){var e;return!!((e=this.eventHandler_ListenerStorage[t])!=null&&e.length)}has(t,e){var i;return((i=this.eventHandler_ListenerStorage[t])==null?void 0:i.indexOf(e))!==-1}amount(t){var e;return((e=this.eventHandler_ListenerStorage[t])==null?void 0:e.length)||0}}const fe=r=>{let t=new be(r);return t.target=r,{producer:t,consumer:t}};let X="delay"in new IntersectionObserver(()=>{});var x,E,_,H,v,w;class te extends IntersectionObserver{constructor(e){super(i=>{if(s(this,E)===0&&s(this,x)===0){for(let n=0;n<i.length;n++)i[n].target._setVisible(i[n].isIntersecting);return}for(let n=0;n<i.length;n++)if(i[n].isIntersecting){s(this,v).push(i[n].target);let h=s(this,w).indexOf(i[n].target);h!==-1&&s(this,w).splice(h,1)}else{s(this,w).push(i[n].target);let h=s(this,v).indexOf(i[n].target);h!==-1&&s(this,v).splice(h,1)}s(this,_)||l(this,_,setTimeout(()=>{for(let n=0;n<s(this,v).length;n++)s(this,v)[n]._setVisible(!0);l(this,v,[]),l(this,_,null)},s(this,x))),s(this,H)||l(this,H,setTimeout(()=>{for(let n=0;n<s(this,w).length;n++)s(this,w)[n]._setVisible(!1);l(this,w,[]),l(this,H,null)},s(this,E)))},X&&e.defferedVisible===e.defferedHidden?{delay:e.defferedVisible,...e}:e);o(this,x,void 0);o(this,E,void 0);o(this,_,null);o(this,H,null);o(this,v,[]);o(this,w,[]);X&&e.defferedVisible===e.defferedHidden?(l(this,x,0),l(this,E,0)):(l(this,x,e.defferedVisible??250),l(this,E,e.defferedHidden??250))}}x=new WeakMap,E=new WeakMap,_=new WeakMap,H=new WeakMap,v=new WeakMap,w=new WeakMap;var z=(r=>(r[r.Connect=0]="Connect",r[r.Disconnect=1]="Disconnect",r[r.Adopted=2]="Adopted",r))(z||{}),c,m,L,k,a,d,p,B,T,F;class se extends HTMLElement{constructor(...e){super();o(this,c,void 0);o(this,m,void 0);o(this,L,void 0);o(this,k,void 0);o(this,a,void 0);o(this,d,void 0);o(this,p,void 0);o(this,B,void 0);o(this,T,void 0);o(this,F,void 0);this.isVisible=!1;let i=fe(this);this._events=i.producer,this.events=i.consumer}static elementName(){return"@abstract@"}static elementNameSpace(){return"chocolatelibui-core"}connectedCallback(){if(this._events.emit("connect",0),s(this,c)&&s(this,m))for(let e=0;e<s(this,c).length;e++)s(this,c)[e].subscribe(s(this,m)[e],!0);s(this,a)?s(this,a).observe(this):this._setVisible(!0)}disconnectedCallback(){if(this._events.emit("connect",1),s(this,c)&&s(this,m))for(let e=0;e<s(this,c).length;e++)s(this,c)[e].unsubscribe(s(this,m)[e]);s(this,a)&&(s(this,a).unobserve(this),this._setVisible(!1))}adoptedCallback(){this._events.emit("connect",2)}_setVisible(e){if(this.isVisible!==e){if(this.isVisible=e,this._events.emit("visible",e),e){if(s(this,d)&&s(this,p))for(let i=0;i<s(this,d).length;i++)s(this,d)[i].subscribe(s(this,p)[i],!0)}else if(s(this,d)&&s(this,p))for(let i=0;i<s(this,d).length;i++)s(this,d)[i].unsubscribe(s(this,p)[i])}}options(e){return this.access=e.access??g.write,e.observerOptions&&l(this,k,e.observerOptions),this}get observer(){return s(this,L)?s(this,L):l(this,L,new te(s(this,k)??{root:this,threshold:0,defferedHidden:1e3}))}attachToObserver(e){e?(this.isConnected&&(s(this,a)&&s(this,a).unobserve(this),e.observe(this)),l(this,a,e)):s(this,a)&&(this.isConnected&&s(this,a).unobserve(this),this.isVisible||this._setVisible(!0),l(this,a,void 0))}attachToBaseObserver(e){e?(this.isConnected&&(s(this,a)&&s(this,a).unobserve(this),e.observer.observe(this)),l(this,a,e.observer)):s(this,a)&&(this.isConnected&&s(this,a).unobserve(this),this.isVisible||this._setVisible(!0),l(this,a,void 0))}attachState(e,i,n){return n?(s(this,d)||(l(this,d,[]),l(this,p,[])),s(this,d).push(e),s(this,p).push(i),this.isVisible&&e.subscribe(i,!0),i):(s(this,c)||(l(this,c,[]),l(this,m,[])),s(this,c).push(e),s(this,m).push(i),this.isConnected&&e.subscribe(i,!0),i)}dettachState(e,i){if(i){if(s(this,p)){let n=s(this,p).indexOf(e);n===-1?console.warn("Function not registered with element",e,this):(this.isVisible&&s(this,d)[n].unsubscribe(e),s(this,d).splice(n,1),s(this,p).splice(n,1))}return}if(s(this,m)){let n=s(this,m).indexOf(e);n===-1?console.warn("Function not registered with element",e,this):(this.isVisible&&s(this,c)[n].unsubscribe(e),s(this,c).splice(n,1),s(this,m).splice(n,1))}}attachStateToProp(e,i,n,h){s(this,T)||l(this,T,{}),this.dettachStateFromProp(e),s(this,T)[e]=[this.attachState(i,u=>{u.ok?this[e]=u.value:n!==void 0&&(this[e]=n)},h),!!h]}dettachStateFromProp(e){s(this,T)&&e in s(this,T)&&this.dettachState(...s(this,T)[e])}attachStateToAttribute(e,i,n,h){s(this,F)||l(this,F,{}),this.dettachStateFromAttribute(e),s(this,F)[e]=[this.attachState(i,u=>{u.ok?this.setAttribute(e,u.value):n!==void 0&&this.setAttribute(e,n)},h),!!h]}dettachStateFromAttribute(e){s(this,F)&&e in s(this,F)&&this.dettachState(...s(this,F)[e])}set access(e){if(typeof e=="object")this.attachStateToProp("access",e,g.none);else switch(l(this,B,e),e){case g.write:this.inert=!1;break;case g.read:this.inert=!0;break;case g.none:this.setAttribute("inert","none");break}}get access(){return s(this,B)??g.write}}c=new WeakMap,m=new WeakMap,L=new WeakMap,k=new WeakMap,a=new WeakMap,d=new WeakMap,p=new WeakMap,B=new WeakMap,T=new WeakMap,F=new WeakMap;const me=new Set(["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"]);var pe=/^[a-z](?:[\.0-9_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*-(?:[\x2D\.0-9_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/;let ge=r=>r?/[A-Z]/.test(r)?"Custom element names must not contain uppercase ASCII characters.":r.includes("-")?/^\d/i.test(r)?"Custom element names must not start with a digit.":/^-/i.test(r)?"Custom element names must not start with a hyphen.":pe.test(r)?me.has(r)?`The supplied element name is reserved and can't be used.
See: https://html.spec.whatwg.org/multipage/scripting.html#valid-custom-element-name`:"Unknown fault":"Invalid element name.":"Custom element names must contain a hyphen. Example: unicorn-cake":"Missing element name.",ie=r=>{let t=r.elementNameSpace(),e=r.elementName,i="",n=r;for(;n!==HTMLElement&&t===n.elementNameSpace();){let h=n.elementName();if(n=Object.getPrototypeOf(n),e===n.elementName)throw new Error("Element uses same name as ancestor, abstract classes should return '@abstract@'");if(!h.length)throw new Error("Element doesn't define element name");h!=="@abstract@"&&(i="-"+h+i)}i=t+i;try{customElements.define(i,r)}catch(h){throw h.message.includes("has already been used with this registry")?h:new Error(ge(i)+" "+i)}};class j extends se{constructor(t){super(),this.number=0,this.connects=0,this.disconnects=0,this.visible=0,this.invisible=0,this.style.height="2rem",this.events.on("connect",e=>{switch(e.data){case z.Connect:this.connects++,console.log("con1");break;case z.Disconnect:this.disconnects++,console.log("con2");break}this.render()}),this.events.on("visible",e=>{e.data?(this.visible++,console.log("vis1")):(this.invisible++,console.log("vis2")),this.render()})}static elementName(){return"testclass"}options(t){return this}render(){this.innerHTML=`Test Element ${this.number} Connects:${this.connects} Disconnects${this.disconnects} Visible:${this.visible} Invisible${this.invisible}`,this.style.backgroundColor=`rgb(${+!this.isVisible*255},${Number(this.isVisible)*255},0)`}}ie(j);class re extends se{constructor(){super()}static elementName(){return"testclass2"}}ie(re);let Q=new re;document.body.appendChild(Q);let ne=new M(C("Testing Attention Please"));Q.attachStateToProp("innerHTML",ne);setTimeout(()=>{ne.set(C("Testing something else"))},2e3);let N=new M(C(g.write));Q.access=N;setTimeout(()=>{N.set(C(g.none)),setTimeout(()=>{N.set(C(g.read)),setTimeout(()=>{N.set(ae({reason:"Test Error"}))},2e3)},2e3)},2e3);let R=document.body.appendChild(document.createElement("div")),ve=R.appendChild(document.createElement("div"));ve.innerHTML="Test Connecting";let he=R.appendChild(document.createElement("button"));he.innerHTML="Toggle Connect";he.onclick=()=>{O.children.length===0?K.forEach(r=>{O.appendChild(r)}):O.replaceChildren()};let O=R.appendChild(document.createElement("div"));O.style.display="flex";O.style.flexDirection="column";let we=new M(C("TestAttribute")),K=[];for(let r=0;r<=19;r++){let t=new j(String(r));O.appendChild(t),K[r]=t,t.attachStateToAttribute("test",we)}let Te=new M(C(g.write));K[0].attachStateToProp("access",Te);let I=document.body.appendChild(document.createElement("div")),Fe=I.appendChild(document.createElement("div"));Fe.innerHTML="Test Observer";let le=I.appendChild(document.createElement("button"));le.innerHTML="Toggle Observer";let $=!0;le.onclick=()=>{Z.forEach(r=>{r.attachToObserver($?void 0:ue)}),$=!$};let oe=I.appendChild(document.createElement("button"));oe.innerHTML="Toggle Connect";oe.onclick=()=>{y.children.length===0?Z.forEach(r=>{y.appendChild(r)}):y.replaceChildren()};let y=I.appendChild(document.createElement("div"));y.style.display="flex";y.style.flexDirection="column";let ue=new te({threshold:.99,defferedVisible:250,defferedHidden:2e3}),Z=[];for(let r=0;r<=99;r++){let t=new j(String(r));t.attachToObserver(ue),y.appendChild(t),Z[r]=t}
