var O=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var o=(s,e,t)=>(O(s,e,"read from private field"),t?t.call(s):e.get(s)),d=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},a=(s,e,t,r)=>(O(s,e,"write to private field"),r?r.call(s,t):e.set(s,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class S{constructor(e){this.value=e}get ok(){return!0}get err(){return!1}expect(){return this.value}expectErr(e){throw new Error(e)}get unwrap(){return this.value}unwrapOr(){return this.value}andThen(e){return e(this.value)}orElse(){return this}map(e){return new S(e(this.value))}mapErr(){return this}get toOptional(){return new N(this.value)}safeUnwrap(){return this.value}}var b;const D=class D{constructor(e){d(this,b,void 0);a(this,b,new Error().stack),this.error=e}get valid(){return!1}get ok(){return!1}get err(){return!0}expect(e){throw new Error(e+`
Original `+o(this,b)+`
Expect Error`)}expectErr(){return this.error}get unwrap(){throw new Error(`Tried to unwrap Error
Original `+o(this,b)+`
Unwrap Error`)}unwrapOr(e){return e}andThen(){return this}orElse(e){return e(this.error)}map(){return this}mapErr(e){return new D(e(this.error))}get toOptional(){return new B}get stack(){return o(this,b)}};b=new WeakMap;let F=D,N=class k{constructor(e){this.value=e}get valid(){return!0}get some(){return!0}get none(){return!1}expect(){return this.value}get unwrap(){return this.value}unwrapOr(){return this.value}andThen(e){return e(this.value)}orElse(){return this}map(e){return new k(e(this.value))}toResult(){return new S(this.value)}};class B{get valid(){return!1}get some(){return!1}get none(){return!0}expect(e){throw new Error(e)}get unwrap(){throw new Error("Tried to unwrap None")}unwrapOr(e){return e}andThen(){return this}orElse(e){return e()}map(){return this}toResult(e){return new F(e)}}function L(s){return new S(s)}function H(s){return new N(s)}function P(){return new B}class Z{constructor(){this.subscribers=[]}subscribe(e,t){return this.subscribers.includes(e)?(console.warn("Function already registered as subscriber"),e):(this.subscribers.push(e),t&&this.then(r=>{e(r)}),e)}unsubscribe(e){const t=this.subscribers.indexOf(e);return t!=-1?this.subscribers.splice(t,1):console.warn("Subscriber not found with state",this,e),e}related(){return P()}inUse(){return!!this.subscribers.length}hasSubscriber(e){return this.subscribers.includes(e)}updateSubscribers(e){for(let t=0,r=this.subscribers.length;t<r;t++)try{this.subscribers[t](e)}catch(i){console.warn("Failed while calling subscribers ",i,this,this.subscribers[t])}}}var h,f,l,g;class M extends Z{constructor(t,r,i,n){super();d(this,h,void 0);d(this,f,void 0);d(this,l,void 0);d(this,g,void 0);r&&a(this,f,r===!0?c=>o(this,l)?o(this,l).limit(c).map(u=>L(u)):H(L(c)):r),i&&a(this,l,i),n&&a(this,g,n),t instanceof Promise?(this.then=t.then.bind(t),t.then(c=>{a(this,h,c),delete this.then})):typeof t=="function"?this.then=async c=>{let u=t();return this.then=u.then,u.then(K=>{a(this,h,K),delete this.then}),u.then(c)}:a(this,h,t)}async then(t){return t(o(this,h))}related(){return o(this,g)?o(this,g).call(this):P()}write(t){o(this,f)&&o(this,h).value!==t&&o(this,f).call(this,t).map(this.set.bind(this))}check(t){return o(this,l)?o(this,l).check(t):void 0}limit(t){return o(this,l)?o(this,l).limit(t):H(t)}set(t){a(this,h,t),this.updateSubscribers(t)}}h=new WeakMap,f=new WeakMap,l=new WeakMap,g=new WeakMap;var p=(s=>(s.write="w",s.read="r",s.none="n",s))(p||{});class G{constructor(e,t,r){this.type=e,this.target=t,this.data=r}}class J{constructor(e){this.eventHandler_ListenerStorage={},this.target=e}on(e,t){let r=this.eventHandler_ListenerStorage[e];return r?r.indexOf(t)==-1?r.push(t):console.warn("Subscriber already in handler"):this.eventHandler_ListenerStorage[e]=[t],t}once(e,t){return this.on(e,function(r){return t(r),!0}),t}off(e,t){let r=this.eventHandler_ListenerStorage[e];if(r){let i=r.indexOf(t);i!=-1?r.splice(i,1):console.warn("Subscriber not in handler")}return t}emit(e,t){let r=this.eventHandler_ListenerStorage[e];if(r&&r.length>0){let i=Object.freeze(new G(e,this.target,t));r.length>1&&(r=[...r]);for(let n=0,c=r.length;n<c;n++)try{r[n](i)===!0&&(r.splice(n,1),c--,n--)}catch(u){console.warn("Failed while dispatching event",u)}}}clear(e){this.eventHandler_ListenerStorage[e]=[]}inUse(e){var t;return!!((t=this.eventHandler_ListenerStorage[e])!=null&&t.length)}has(e,t){var r;return((r=this.eventHandler_ListenerStorage[e])==null?void 0:r.indexOf(t))!==-1}amount(e){var t;return((t=this.eventHandler_ListenerStorage[e])==null?void 0:t.length)||0}}const Q=s=>{let e=new J(s);return e.target=s,{producer:e,consumer:e}};var C=(s=>(s[s.Connect=0]="Connect",s[s.Disconnect=1]="Disconnect",s[s.Adopted=2]="Adopted",s))(C||{});class V extends HTMLElement{constructor(...e){super(),this.isVisible=!1;let t=Q(this);this._events=t.producer,this.events=t.consumer}static elementName(){return"@abstract@"}static elementNameSpace(){return"chocolatelibui-core"}connectedCallback(){if(this._events.emit("connect",0),this._connectStates&&this._connectSubscribers)for(let e=0;e<this._connectStates.length;e++)this._connectStates[e].subscribe(this._connectSubscribers[e],!0);this._observer?this._observer.observe(this):this._setVisible(!0)}disconnectedCallback(){if(this._events.emit("connect",1),this._connectStates&&this._connectSubscribers)for(let e=0;e<this._connectStates.length;e++)this._connectStates[e].unsubscribe(this._connectSubscribers[e]);this._observer&&(this._observer.unobserve(this),this._setVisible(!1))}adoptedCallback(){this._events.emit("connect",2)}_setVisible(e){if(this.isVisible!==e){if(this.isVisible=e,this._events.emit("visible",e),e){if(this._visibleStates&&this._visibleSubscribers)for(let t=0;t<this._visibleStates.length;t++)this._visibleStates[t].subscribe(this._visibleSubscribers[t],!0)}else if(this._visibleStates&&this._visibleSubscribers)for(let t=0;t<this._visibleStates.length;t++)this._visibleStates[t].unsubscribe(this._visibleSubscribers[t])}}options(e){return this.access=e.access,this}attachToObserver(e){e?(this.isConnected&&(this._observer&&this._observer.unobserve(this),e.observe(this)),this._observer=e):this._observer&&(this.isConnected&&this._observer.unobserve(this),this.isVisible||this._setVisible(!0),this._observer=void 0)}attachState(e,t,r){return r?(this._visibleStates||(this._visibleStates=[],this._visibleSubscribers=[]),this._visibleStates.push(e),this._visibleSubscribers.push(t),this.isVisible&&e.subscribe(t,!0),t):(this._connectStates||(this._connectStates=[],this._connectSubscribers=[]),this._connectStates.push(e),this._connectSubscribers.push(t),this.isConnected&&e.subscribe(t,!0),t)}dettachState(e,t){if(t){if(this._visibleSubscribers){let r=this._visibleSubscribers.indexOf(e);r===-1?console.warn("Function not registered with element",e,this):(this.isVisible&&this._visibleStates[r].unsubscribe(e),this._visibleStates.splice(r,1),this._visibleSubscribers.splice(r,1))}return}if(this._connectSubscribers){let r=this._connectSubscribers.indexOf(e);r===-1?console.warn("Function not registered with element",e,this):(this.isVisible&&this._connectStates[r].unsubscribe(e),this._connectStates.splice(r,1),this._connectSubscribers.splice(r,1))}}attachStateToProp(e,t,r,i){this._propStates||(this._propStates={}),this.dettachStateFromProp(e),this._propStates[e]=[this.attachState(t,n=>{n.ok?this[e]=n.value:r!==void 0&&(this[e]=r)},i),!!i]}dettachStateFromProp(e){this._propStates&&e in this._propStates&&this.dettachState(...this._propStates[e])}set access(e){switch(this._access=e,e){case p.write:this.inert=!1;break;case p.read:this.inert=!0;break;case p.none:this.setAttribute("inert","none");break}}get access(){return this._access??p.write}}const W=new Set(["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"]);var X=/^[a-z](?:[\.0-9_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*-(?:[\x2D\.0-9_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/;let Y=s=>s?/[A-Z]/.test(s)?"Custom element names must not contain uppercase ASCII characters.":s.includes("-")?/^\d/i.test(s)?"Custom element names must not start with a digit.":/^-/i.test(s)?"Custom element names must not start with a hyphen.":X.test(s)?W.has(s)?`The supplied element name is reserved and can't be used.
See: https://html.spec.whatwg.org/multipage/scripting.html#valid-custom-element-name`:"Unknown fault":"Invalid element name.":"Custom element names must contain a hyphen. Example: unicorn-cake":"Missing element name.",$=s=>{let e=s.elementNameSpace(),t=s.elementName,r="",i=s;for(;i!==HTMLElement&&e===i.elementNameSpace();){let n=i.elementName();if(i=Object.getPrototypeOf(i),t===i.elementName)throw new Error("Element uses same name as ancestor, abstract classes should return '@abstract@'");if(!n.length)throw new Error("Element doesn't define element name");n!=="@abstract@"&&(r="-"+n+r)}r=e+r;try{customElements.define(r,s)}catch(n){throw n.message.includes("has already been used with this registry")?n:new Error(Y(r)+" "+r)}};class ee extends IntersectionObserver{constructor(e){super(t=>{for(let r=0;r<t.length;r++)t[r].target._setVisible(t[r].isIntersecting)},e)}}class T extends V{constructor(e){super(),this.number=0,this.connects=0,this.disconnects=0,this.visible=0,this.invisible=0,this.style.height="2rem",this.events.on("connect",t=>{switch(t.data){case C.Connect:this.connects++,console.log("con1");break;case C.Disconnect:this.disconnects++,console.log("con2");break}this.render()}),this.events.on("visible",t=>{t.data?(this.visible++,console.log("vis1")):(this.invisible++,console.log("vis2")),this.render()})}static elementName(){return"testclass"}options(e){return this}render(){this.innerHTML=`Test Element ${this.number} Connects:${this.connects} Disconnects${this.disconnects} Visible:${this.visible} Invisible${this.invisible}`,this.style.backgroundColor=`rgb(${+!this.isVisible*255},${Number(this.isVisible)*255},0)`}}$(T);class I extends V{constructor(){super()}static elementName(){return"testclass2"}}$(I);let A=new I;document.body.appendChild(A);let U=new M("Testing Attention Please");A.attachStateToProp("innerHTML",U);setTimeout(()=>{U.set("Testing something else")},2e3);let x=document.body.appendChild(document.createElement("div")),te=x.appendChild(document.createElement("div"));te.innerHTML="Test Connecting";let z=x.appendChild(document.createElement("button"));z.innerHTML="Toggle Connect";z.onclick=()=>{m.children.length===0?E.forEach(s=>{m.appendChild(s)}):m.replaceChildren()};let m=x.appendChild(document.createElement("div"));m.style.display="flex";m.style.flexDirection="column";let E=[];for(let s=0;s<=19;s++){let e=new T(String(s));m.appendChild(e),E[s]=e}let se=new M(p.write);E[0].attachStateToProp("access",se);let w=document.body.appendChild(document.createElement("div")),re=w.appendChild(document.createElement("div"));re.innerHTML="Test Observer";let j=w.appendChild(document.createElement("button"));j.innerHTML="Toggle Observer";let _=!0;j.onclick=()=>{y.forEach(s=>{s.attachToObserver(_?void 0:q)}),_=!_};let R=w.appendChild(document.createElement("button"));R.innerHTML="Toggle Connect";R.onclick=()=>{v.children.length===0?y.forEach(s=>{v.appendChild(s)}):v.replaceChildren()};let v=w.appendChild(document.createElement("div"));v.style.display="flex";v.style.flexDirection="column";let q=new ee({threshold:.9}),y=[];for(let s=0;s<=99;s++){let e=new T(String(s));e.attachToObserver(q),v.appendChild(e),y[s]=e}
